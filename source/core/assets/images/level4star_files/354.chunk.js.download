(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["354"],{3260:function(e,t,n){"use strict";n.r(t);n.d(t,"resourceKey",function(){return M});var r=n(0),i=n(516),s=n(8),o=n(48),u=n(18),a=n(25),f=n(33),l=n(362),c=n(259),h=n(226),p=n(34),d=n(826),v=n(5),m=n(37),g=n(2606),y=n(54),b=n(2955),w=n(110),E=n(145),S=n(11),x=n(9),T=n(978),N=n(40),C=n(15),k=n(17),L=["3gp","aac","m4a","mp3","wav","wma"],A=window.$Config&&window.$Config.mkt,O=(function(e){Object(r.__extends)(t,e);function t(t,n){void 0===t&&(t={});var r=e.call(this,t,n)||this,s=n.identityDataSource.getIdentity().type,o=s===i.e.msa;r._capabilities={supportsResultsWheeling:o,minimumQueryLength:0,maxQueryRate:100,showNoResults:!1,showOnlyResults:!0,supportsSearchFiltering:!0};r._navigation=n.navigation;r._urlDataSource=n.urlDataSource;r._regenerateCvid();r._paddedCid=m.rightPad(E.t.viewerId,32);if(s===i.e.anonymous)r._requirePromise=a.n.wrap();else{var f="https://www.bing.com/as/init?"+u.n({pt:"onedrive",clientid:r._paddedCid});r._requirePromise=new a.n(function(e,t){return window.require([f],e,t)})}return r}t.prototype.getCapabilities=function(){return this._capabilities};t.prototype.getItems=function(e,t){var n=this;void 0===e&&(e="");var r=new h.e({name:"Odc.Search.QF.SearchDataSource.getItems"});return this._requirePromise.then(function(){return new a.n(function(r){var i=null;t&&t.type===N.e.Folder&&t.queryType===x.e.Files&&(i=t.id);AutoSuggest.getSuggestions(e,g.e,n._cvid,!0,null,i,n._paddedCid,function(e){var t=null;e&&(t=JSON.parse(e));r(t)},A)})}).then(function(t){r.end({resultType:p.e.Success});var i=new h.e({name:"Odc.Search.QF.SearchDataSource.ResponseToRender"}),s=[];if(t&&t.suggestionGroups){var o=t.pingUrlBase||t.instrumentation&&t.instrumentation.pingUrlBase;t.suggestionGroups.forEach(function(e){var t=e.suggestionContainers||e.searchSuggestions;if(t){var r=[];t.forEach(function(t){if(t.suggestion){var i=t.content&&t.content[0].documents[0];(n._urlDataSource.getPageType()!==S.e.Photos||i&&"Photo"===i.type||i&&"Video"===i.type||"Tag"===t.suggestion.type||"History"===t.suggestion.type)&&r.push(n._getSuggestionFromContainer(o,t))}else{var s=t.result&&t.result[0];if(n._urlDataSource.getPageType()!==S.e.Photos||s&&"Photo"===s.type||s&&"Video"===s.type||"PersonalSearchTags"===e.name||"SearchHistory"===e.name){var u=n._getSuggestionFromContainer(o,t,e.name);u&&r.push(u)}}});s.push({results:r})}})}return{query:e,containers:s,responseToRenderEvent:i}}).then(null,function(t){if(t&&t instanceof Error&&"Canceled"===t.name){r.end({resultType:p.e.ExpectedFailure});return{query:e,containers:[]}}r.end({resultType:p.e.Failure,resultCode:t.status});return a.n.wrapError(w.i)})};t.prototype.upscopeSearch=function(e){var t=e.query,n=this._urlDataSource.getSearchQueryUrl({query:t,conversationId:this._cvid});this._regenerateCvid();n&&this._navigation.navigateTo(n)};t.prototype.searchResultClicked=function(e){this._regenerateCvid()};t.prototype._getSuggestionFromContainer=function(e,t,n){void 0===n&&(n="");var r=t.suggestion,i=r&&r.name||t.displayText,s=i.replace(/\ue000/g,"").replace(/\ue001/g,""),o=i;o=(o=(o=f.e.encodeText(o)).replace(/\ue000/g,'<span class="od-SearchResults-result-highlight">')).replace(/\ue001/g,"</span>");var u=y.t.all;this._urlDataSource.isCurrentQuery(x.e.Photos)&&(u=y.t.photos);var a=this._urlDataSource.getSearchQueryUrl({query:s,filter:u}),l="",c=r&&r.urlPingSuffix||t.urlPingSuffix;e&&c&&(l=e+c);var h={title:o,titleText:s,titleAriaLabel:s,url:a,instrumentationUrl:l,type:1};return r&&"Tag"===r.type||"PersonalSearchTags"===n?this._makeTagSuggestion(s,t,h):r&&"History"===r.type||"SearchHistory"===n?this._makeHistorySuggestion(s,t,h):(r&&"Document"===r.type&&t.content&&t.content.length||"PersonalSearchDocuments"===n)&&t.result&&t.result.length?this._makeDocumentSuggestion(s,t,h):null};t.prototype._makeHistorySuggestion=function(e,t,n){n.type=4;n.glyph=new k.e("Clock");n.titleAriaLabel=m.format(b.e,e);return n};t.prototype._makeTagSuggestion=function(e,t,n){var r=t.suggestion&&t.suggestion.query.substr(1)||t.query.substr(1);n.type=3;n.glyph=new k.e("Tag");n.titleAriaLabel=m.format(b.r,r);n.url=this._urlDataSource.getTagUrl({localizedTag:r,source:"UserDefined",tag:r,type:"keyword"});return n};t.prototype._makeDocumentSuggestion=function(e,t,n){var r=t.content&&t.content[0]&&t.content[0].documents[0]||t.result[0],i=r.rawResourceId,s=d.t(e,!0);n.key=this._urlDataSource.getKey({id:i});if(this._openItemExternally(s)){n.key=null;n.url=E.t.getResourceRedirectUrl(i)}if("Folder"===r.type){n.iconName="folder";n.titleAriaLabel=m.format(b.n,e)}else{n.iconName=c.t(d.t(e));n.titleAriaLabel=m.format(b.t,e)}r.parentFolder&&r.parentFolder.name&&(n.parentFolder=r.parentFolder.name);return n};t.prototype._regenerateCvid=function(){this._cvid=l.e.generate()};t.prototype._openItemExternally=function(e){return T.o(e)||this._isXboxMusicAudio(e)};t.prototype._isXboxMusicAudio=function(e){return-1!==L.indexOf(e)};t.dependencies=Object(r.__assign)(Object(r.__assign)({},s.n.dependencies),{identityDataSource:C.x,navigation:o.e,urlDataSource:C.ye});return t})(s.n);t.default=O;var M=Object(v.s)("SearchDataSource",O)}}]);